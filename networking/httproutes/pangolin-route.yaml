apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: pangolin
  namespace: pangolin
spec:
  parentRefs:
    - name: main-gateway
      namespace: cert-manager
      sectionName: pangolin-https
  hostnames:
    - "pangolin.timosur.com"
  rules:
    # API router (handles /api/v1 paths) - MUST come first
    - matches:
        - path:
            type: PathPrefix
            value: /api/v1
      backendRefs:
        - name: pangolin
          port: 3001
    # WebSocket router (handles WebSocket upgrades)
    - matches:
        - headers:
            - name: upgrade
              value: websocket
              type: Exact
      backendRefs:
        - name: pangolin
          port: 3000
    # Next.js router (catch-all for everything else)
    - matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - name: pangolin
          port: 3002