apiVersion: config.gateway.envoyproxy.io/v1alpha1
kind: SecurityPolicy
metadata:
  name: coraza-waf-policy
  namespace: cert-manager
spec:
  targetRefs:
    - group: gateway.networking.k8s.io
      kind: Gateway
      name: envoy-gateway
  cors:
    allowOrigins:
    - "https://timosur.com"
    - "https://*.timosur.com"
    - "https://givgroov.de"
    allowMethods:
    - GET
    - POST
    - PUT
    - DELETE
    - OPTIONS
    allowHeaders:
    - "*"
    maxAge: 86400
  basicAuth:
    users:
      # This will be populated via external secret for sensitive endpoints
      secretRef:
        name: basic-auth-secret
  jwt:
    providers:
    - name: "auth0"
      issuer: "https://dev-auth.timosur.com"
      audiences:
      - "api.timosur.com"
      remoteJWKS:
        uri: "https://dev-auth.timosur.com/.well-known/jwks.json"