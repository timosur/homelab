apiVersion: v1
kind: ConfigMap
metadata:
  name: seafile-mysql-init
  namespace: seafile
data:
  init.sql: |
    -- Create databases for Seafile
    CREATE DATABASE IF NOT EXISTS ccnet_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
    CREATE DATABASE IF NOT EXISTS seafile_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
    CREATE DATABASE IF NOT EXISTS seahub_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
    
    -- Grant all privileges to seafile user on all three databases
    GRANT ALL PRIVILEGES ON ccnet_db.* TO 'seafile'@'%';
    GRANT ALL PRIVILEGES ON seafile_db.* TO 'seafile'@'%';
    GRANT ALL PRIVILEGES ON seahub_db.* TO 'seafile'@'%';
    
    -- Flush privileges to ensure changes take effect
    FLUSH PRIVILEGES;
