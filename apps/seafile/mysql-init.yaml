apiVersion: v1
kind: ConfigMap
metadata:
  name: seafile-mysql-init
  namespace: seafile
data:
  init-seafile.sql: |
    -- Create databases for Seafile
    CREATE DATABASE IF NOT EXISTS ccnet_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
    CREATE DATABASE IF NOT EXISTS seafile_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
    CREATE DATABASE IF NOT EXISTS seahub_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
    
    -- Create seafile user if it doesn't exist
    CREATE USER IF NOT EXISTS 'seafile'@'%' IDENTIFIED BY '${MYSQL_PASSWORD}';
    
    -- Grant permissions
    GRANT ALL PRIVILEGES ON ccnet_db.* TO 'seafile'@'%';
    GRANT ALL PRIVILEGES ON seafile_db.* TO 'seafile'@'%';
    GRANT ALL PRIVILEGES ON seahub_db.* TO 'seafile'@'%';
    
    FLUSH PRIVILEGES;
