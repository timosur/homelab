apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    email: homelab@timosur.com
    privateKeySecretRef:
      name: letsencrypt-prod
    solvers:
      # argo.timosur.com -> argo-http listener
      - selector:
          dnsNames: ["argo.timosur.com"]
        http01:
          gatewayHTTPRoute:
            parentRefs:
              - group: gateway.networking.k8s.io
                kind: Gateway
                name: main-gateway
                namespace: cert-manager
                sectionName: argo-http
      # mealie.timosur.com -> mealie-http listener
      - selector:
          dnsNames: ["mealie.timosur.com"]
        http01:
          gatewayHTTPRoute:
            parentRefs:
              - group: gateway.networking.k8s.io
                kind: Gateway
                name: main-gateway
                namespace: cert-manager
                sectionName: mealie-http
